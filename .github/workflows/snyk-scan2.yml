name: Snyk vulnerability reports manual

on:
  workflow_dispatch:

jobs:
  cron:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout project
      uses: actions/checkout@v3
    - name: Scan vulnerabilities with snyk
      run: |
        cd scan-prj
        bash build-pom.sh
        npm install snyk -g
        snyk auth ${{ secrets.SNYK_TOKEN }}
        snyk test >> snyk-results.txt || true
        echo ""
        echo ""
        echo "starting report"
        echo ""
        echo ""
        LINE_NUM=1
        while read LINE
        do
          if [[ $LINE == Upgrade* ]]
          then
            echo "How to fix: ${LINE}"
            echo "Lib:"
            echo "From version:"
            echo "To version:"
          elif [[ $LINE == "Issues with no direct upgrade"* ]]
          then
            echo "No direct upgrade: ${LINE}"
          elif [[ $LINE == "No upgrade or patch available"* ]]
          then
            echo "No fix: ${LINE}"
          elif [[ $LINE == "This issue was fixed in versions"* ]]
          then
            echo "Explicity fix: ${LINE}"
            echo "Explicity fix version:"
          elif [[ $LINE == âœ—* ]]
          then
            echo "Vulnerability: ${LINE}"
            echo "Vulnerability type:"
            echo "Severity:"
            echo "Snyk link:"
          elif [[ $LINE == "introduced by"* ]]
          then
            echo "Introduced: ${LINE}"
            echo "Lib:"
            echo "Version:"
          fi
          ((LINE_NUM++))
        done < snyk-results.txt
        echo ""
        echo ""
        echo "finished report"
        echo ""
        echo ""
        cat snyk-results.txt